# Generate Roadmapæµç¨‹æ”¹è¿›

## ğŸ“‹ é—®é¢˜èƒŒæ™¯

ç”¨æˆ·è¯¢é—®ï¼š
1. ç”¨æˆ·åœ¨æ–°å»ºè·¯çº¿å›¾æ—¶ç‚¹å‡»generateæŒ‰é’®åå¯å¦ç›´æ¥è·³è½¬åˆ°ä»»åŠ¡è¯¦æƒ…é¡µï¼Ÿ
2. ä»»åŠ¡IDç”Ÿæˆæ—¶æœºæ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ

---

## ğŸ” åŸæµç¨‹åˆ†æ

### ä»»åŠ¡IDç”Ÿæˆæ—¶æœº

```
ç”¨æˆ·æ“ä½œï¼šç‚¹å‡»"Generate Roadmap"æŒ‰é’®
    â†“
åç«¯å¤„ç†ï¼šåˆ›å»ºä»»åŠ¡å¹¶ç«‹å³è¿”å›task_id
    â†“
å‰ç«¯æ¥æ”¶ï¼šonSuccesså›è°ƒæ”¶åˆ°response.task_id
    â†“
WebSocketï¼šå¯åŠ¨å®æ—¶ç›‘å¬ä»»åŠ¡è¿›åº¦
```

**å…³é”®ç‚¹ï¼š** task_idåœ¨APIå“åº”æ—¶**ç«‹å³ç”Ÿæˆ**ï¼Œä¸éœ€è¦ç­‰å¾…ä»»åŠ¡å®Œæˆã€‚

---

### åŸè·³è½¬é€»è¾‘

```
/new (æ–°å»ºè·¯çº¿å›¾é¡µé¢)
  â†“ ç‚¹å‡»Generate Roadmap
APIè°ƒç”¨ â†’ è¿”å›task_id
  â†“
åœç•™åœ¨/newé¡µé¢
  â†“ WebSocketç›‘å¬è¿›åº¦
  â†“ æ˜¾ç¤ºè¿›åº¦æ¡å’ŒçŠ¶æ€
  â†“
ä»»åŠ¡å®Œæˆ (100%)
  â†“ autoNavigate: true
è‡ªåŠ¨è·³è½¬ â†’ /roadmap/{roadmap_id}
```

**é—®é¢˜ï¼š**
- âŒ ç”¨æˆ·å¿…é¡»åœç•™åœ¨`/new`é¡µé¢ç­‰å¾…å®Œæˆ
- âŒ åˆ·æ–°é¡µé¢ä¼šä¸¢å¤±è¿›åº¦æ˜¾ç¤º
- âŒ æ— æ³•å¤åˆ¶/åˆ†äº«æ­£åœ¨ç”Ÿæˆçš„ä»»åŠ¡é“¾æ¥
- âŒ è¿›åº¦çŠ¶æ€å’Œä»»åŠ¡è¯¦æƒ…é¡µé‡å¤

---

## âœ… æ”¹è¿›åçš„æµç¨‹

### æ–°è·³è½¬é€»è¾‘

```
/new (æ–°å»ºè·¯çº¿å›¾é¡µé¢)
  â†“ ç‚¹å‡»Generate Roadmap
APIè°ƒç”¨ â†’ è¿”å›task_id
  â†“ ç«‹å³è·³è½¬ï¼
/tasks/{task_id} (ä»»åŠ¡è¯¦æƒ…é¡µ)
  â†“ WebSocketç›‘å¬è¿›åº¦
  â†“ æ˜¾ç¤ºæ¨ªå‘æ­¥è¿›å™¨å’Œæ—¥å¿—
  â†“ ç”¨æˆ·å¯ç‚¹å‡»å„ä¸ªé˜¶æ®µæŸ¥çœ‹æ—¥å¿—
  â†“
ä»»åŠ¡å®Œæˆ
  â†“ ç”¨æˆ·ç‚¹å‡»"Final"é˜¶æ®µ
æ˜¾ç¤ºRoadmapReadyBanner
  â†“ ç‚¹å‡»æŒ‰é’®
æ‰‹åŠ¨è·³è½¬ â†’ /roadmap/{roadmap_id}
```

**ä¼˜åŠ¿ï¼š**
- âœ… ç”¨æˆ·å¯ä»¥åˆ·æ–°é¡µé¢ä¸ä¸¢å¤±è¿›åº¦
- âœ… å¯ä»¥å¤åˆ¶/åˆ†äº«ä»»åŠ¡é“¾æ¥ç»™åˆ«äººæŸ¥çœ‹
- âœ… ç»Ÿä¸€çš„ä»»åŠ¡è¿½è¸ªä½“éªŒ
- âœ… ç”¨æˆ·ä¸»åŠ¨æŸ¥çœ‹å®Œæˆç»“æœï¼ˆç‚¹å‡»Finalé˜¶æ®µï¼‰
- âœ… æ›´æ¸…æ™°çš„å·¥ä½œæµå¯è§†åŒ–

---

## ğŸ”§ ä»£ç æ”¹åŠ¨

### æ–‡ä»¶ï¼š`app/(app)/new/new-roadmap-client.tsx`

#### 1. ç§»é™¤WebSocketç›‘å¬ï¼ˆå·²è·³è½¬èµ°ï¼‰

```diff
- import { useRoadmapGenerationWS } from '@/lib/hooks/websocket/use-roadmap-generation-ws';

- const { connectionType, isConnected } = useRoadmapGenerationWS(taskId, {
-   onComplete: (roadmapId) => {
-     console.log('[Generation] Complete, navigating to:', roadmapId);
-   },
-   onError: (error) => {
-     console.error('[Generation] Error:', error);
-   },
-   autoNavigate: true,
- });
```

#### 2. æ·»åŠ ç«‹å³è·³è½¬é€»è¾‘

```diff
generateRoadmap(request, {
  onSuccess: (response) => {
    console.log('[Generate] Task created:', response.task_id);
    setTaskId(response.task_id);
+   
+   // ç«‹å³è·³è½¬åˆ°ä»»åŠ¡è¯¦æƒ…é¡µ
+   router.push(`/tasks/${response.task_id}`);
  },
  onError: (error) => {
    console.error('[Generate] Error:', error);
  },
});
```

#### 3. ä¼˜åŒ–ä»»åŠ¡æ¢å¤é€»è¾‘

```diff
// å¦‚æœä»»åŠ¡è¿˜åœ¨è¿›è¡Œä¸­
if (taskStatus === 'processing' || taskStatus === 'pending' || taskStatus === 'human_review_pending') {
- setTaskId(resumeTaskId);
- setStep('generating');
- // æ›´æ–°è¿›åº¦çŠ¶æ€
- if (status.current_step) {
-   const stepInfo = stepProgress[status.current_step];
-   if (stepInfo) {
-     updateProgress(status.current_step, stepInfo.progress);
-   }
- }
+ console.log('[NewRoadmap] Task in progress, navigating to task detail:', resumeTaskId);
+ router.push(`/tasks/${resumeTaskId}`);
  return;
}
```

#### 4. ç§»é™¤generatingæ­¥éª¤çš„UI

```diff
- {step === 'generating' && (
-   <Card>
-     <CardContent className="py-16 text-center">
-       {/* è¿›åº¦æ˜¾ç¤º... */}
-     </CardContent>
-   </Card>
- )}
```

---

## ğŸ¯ ç”¨æˆ·ä½“éªŒå¯¹æ¯”

### Before (åŸæµç¨‹)
```
ç”¨æˆ·: ç‚¹å‡»Generate
å‰ç«¯: [åœç•™åœ¨/newï¼Œæ˜¾ç¤ºè¿›åº¦æ¡]
      [LoaderåŠ¨ç”» + ç™¾åˆ†æ¯” + çŠ¶æ€æ–‡å­—]
      [WebSocketè¿æ¥çŠ¶æ€]
      ç­‰å¾…... (å¯èƒ½2-5åˆ†é’Ÿ)
      [100%å®Œæˆ]
      è‡ªåŠ¨è·³è½¬åˆ°/roadmap/{id}
ç”¨æˆ·: "æˆ‘èƒ½åˆ·æ–°å—ï¼Ÿ" âŒ
ç”¨æˆ·: "æˆ‘èƒ½åˆ†äº«è¿™ä¸ªé“¾æ¥å—ï¼Ÿ" âŒ
```

### After (æ–°æµç¨‹)
```
ç”¨æˆ·: ç‚¹å‡»Generate
å‰ç«¯: [ç«‹å³è·³è½¬åˆ°/tasks/{task_id}] âœ…
      [æ˜¾ç¤ºæ¨ªå‘æ­¥è¿›å™¨]
      [å®æ—¶æ›´æ–°å„é˜¶æ®µçŠ¶æ€]
      [å¯ç‚¹å‡»æŸ¥çœ‹æ¯ä¸ªé˜¶æ®µçš„æ—¥å¿—]
ç”¨æˆ·: "æˆ‘èƒ½åˆ·æ–°é¡µé¢å—ï¼Ÿ" âœ… å¯ä»¥
ç”¨æˆ·: "æˆ‘èƒ½åˆ†äº«è¿™ä¸ªé“¾æ¥å—ï¼Ÿ" âœ… å¯ä»¥
ç”¨æˆ·: ç­‰å¾…å®Œæˆåç‚¹å‡»"Final"é˜¶æ®µ
å‰ç«¯: [æ˜¾ç¤ºRoadmapReadyBanner]
ç”¨æˆ·: ç‚¹å‡»"View Roadmap"æŒ‰é’®
å‰ç«¯: [è·³è½¬åˆ°/roadmap/{id}]
```

---

## ğŸ“Š æŠ€æœ¯æµç¨‹å›¾

### åŸæµç¨‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   /new   â”‚â”€â”€â”€â”€â”€â†’â”‚  API    â”‚â”€â”€â”€â”€â”€â†’â”‚   /new   â”‚
â”‚  é¡µé¢    â”‚Generateâ”‚ task_id â”‚      â”‚ ç­‰å¾…å®Œæˆ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â†“
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ /roadmap â”‚
                                    â”‚   è‡ªåŠ¨   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–°æµç¨‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   /new   â”‚â”€â”€â”€â”€â”€â†’â”‚  API    â”‚â”€â”€â”€â”€â”€â†’â”‚  /tasks  â”‚
â”‚  é¡µé¢    â”‚Generateâ”‚ task_id â”‚ ç«‹å³ â”‚ ä»»åŠ¡è¯¦æƒ… â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                    [ç”¨æˆ·ä¸»åŠ¨]
                                          â†“
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ /roadmap â”‚
                                    â”‚   ç‚¹å‡»   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸ
- [ ] åœ¨`/new`é¡µé¢ç‚¹å‡»Generateåæ·»åŠ çŸ­æš‚çš„loadingçŠ¶æ€
- [ ] æ·»åŠ toastæç¤ºï¼š"Task created, redirecting..."
- [ ] ä»»åŠ¡åˆ—è¡¨é¡µé¢å¯ä»¥çœ‹åˆ°æ‰€æœ‰åˆ›å»ºçš„ä»»åŠ¡

### é•¿æœŸ
- [ ] æ”¯æŒæ‰¹é‡åˆ›å»ºå¤šä¸ªä»»åŠ¡
- [ ] ä»»åŠ¡è¯¦æƒ…é¡µæ”¯æŒå–æ¶ˆ/é‡è¯•
- [ ] æ·»åŠ ä»»åŠ¡å†å²è®°å½•

---

## âœ… éªŒè¯æ¸…å•

- [x] ç‚¹å‡»Generateåç«‹å³è·³è½¬åˆ°`/tasks/{task_id}`
- [x] ä»»åŠ¡è¯¦æƒ…é¡µæ­£å¸¸æ˜¾ç¤ºè¿›åº¦
- [x] åˆ·æ–°ä»»åŠ¡è¯¦æƒ…é¡µè¿›åº¦ä¸ä¸¢å¤±
- [x] URLå‚æ•°æ¢å¤é€»è¾‘æ­£å¸¸å·¥ä½œ
- [x] å®Œæˆåç‚¹å‡»Finalæ˜¾ç¤ºRoadmapReadyBanner
- [x] RoadmapReadyBannerè·³è½¬é“¾æ¥æ­£ç¡®
- [x] ç§»é™¤äº†`/new`é¡µé¢çš„generatingæ­¥éª¤UI
- [x] æ— TypeScript/Linté”™è¯¯

---

*æ”¹è¿›å®Œæˆæ—¶é—´: 2025-12-13*
*æ”¹è¿›ç›®æ ‡: æå‡ç”¨æˆ·ä½“éªŒï¼Œç»Ÿä¸€ä»»åŠ¡è¿½è¸ª*




