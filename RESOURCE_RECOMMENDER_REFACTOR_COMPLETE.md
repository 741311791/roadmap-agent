# ResourceRecommender é‡æ„å®ŒæˆæŠ¥å‘Š

**å®Œæˆæ—¶é—´**: 2025-12-08  
**é‡æ„ç›®æ ‡**: æå‡èµ„æºæ¨èçš„æœ‰æ•ˆæ€§å’Œæ—¶æ•ˆæ€§ï¼Œè§£å†³404é“¾æ¥å’Œè¿‡æ—¶èµ„æºé—®é¢˜

---

## âœ… é‡æ„å®Œæˆæ€»ç»“

æ‰€æœ‰ç›®æ ‡å·²å®Œæˆï¼æˆåŠŸå®æ–½äº†3ä¸ªæ ¸å¿ƒæ–¹æ¡ˆï¼Œæ˜¾è‘—æå‡äº†èµ„æºæ¨èè´¨é‡ã€‚

---

## ğŸ“Š æ”¹è¿›æ•ˆæœå¯¹æ¯”

### æ”¹è¿›å‰

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| URLæœ‰æ•ˆç‡ | 37.5% | ä»…200çŠ¶æ€ç  |
| 404å¤±æ•ˆé“¾æ¥ | 25% | 2/8 é“¾æ¥å¤±æ•ˆ |
| æœç´¢å¼•æ“ | DuckDuckGo | Tavily 432é”™è¯¯ |
| é€Ÿç‡æ§åˆ¶ | âŒ æ—  | è¯·æ±‚è¿‡å¿«è§¦å‘é™æµ |
| æ—¶é—´ç­›é€‰ | âŒ æ—  | å¯èƒ½æ¨èè¿‡æ—¶èµ„æº |
| URLéªŒè¯ | âŒ æ—  | ç›´æ¥æ¨èæœªéªŒè¯é“¾æ¥ |
| å¯ä¿¡åº¦è¯„åˆ† | âŒ æ—  | æ— æ³•åˆ¤æ–­èµ„æºè´¨é‡ |

### æ”¹è¿›å

| æŒ‡æ ‡ | æ•°å€¼ | æ”¹è¿› |
|------|------|------|
| URLæœ‰æ•ˆç‡ | **66.7%** | **+77%** (4/6 ç¡®è®¤æœ‰æ•ˆ) |
| 404å¤±æ•ˆé“¾æ¥ | **0%** | **-100%** (å…¨éƒ¨è¿‡æ»¤) |
| å¯èƒ½æœ‰æ•ˆé“¾æ¥ | 100% | ä¿ç•™403/412 |
| æœç´¢å¼•æ“ | DuckDuckGo | Tavilyä»432(éœ€é…ç½®) |
| é€Ÿç‡æ§åˆ¶ | âœ… æ˜¯ | 500msé—´éš”+3å¹¶å‘ |
| æ—¶é—´ç­›é€‰ | âœ… æ˜¯ | days=730 (2å¹´å†…) |
| URLéªŒè¯ | âœ… æ˜¯ | å¹¶å‘éªŒè¯+è¿‡æ»¤404 |
| å¯ä¿¡åº¦è¯„åˆ† | âœ… æ˜¯ | 0-1è¯„åˆ†ç³»ç»Ÿ |

**å…³é”®æˆæœ**:
- âœ… **404é“¾æ¥å·²å…¨éƒ¨è¿‡æ»¤**ï¼ˆä»2ä¸ªå‡å°‘åˆ°0ä¸ªï¼‰
- âœ… **URLæœ‰æ•ˆç‡æå‡77%**ï¼ˆä»37.5%åˆ°66.7%ï¼‰
- âœ… **æ¨èèµ„æºæ•°é‡ä¼˜åŒ–**ï¼ˆä»8ä¸ªé™åˆ°6ä¸ªé«˜è´¨é‡èµ„æºï¼‰

---

## ğŸ¯ å·²å®Œæˆçš„æ”¹è¿›

### âœ… æ–¹æ¡ˆ1: URLæœ‰æ•ˆæ€§éªŒè¯

**æ–‡ä»¶**: `backend/app/agents/resource_recommender.py`

**å®æ–½å†…å®¹**:
1. æ·»åŠ  `_verify_urls()` æ–¹æ³•
2. å¹¶å‘éªŒè¯æ‰€æœ‰URL (asyncio.gather)
3. è¿‡æ»¤404å’Œ500+é”™è¯¯
4. ä¿ç•™403/412ï¼ˆå¯èƒ½éœ€è¦æµè§ˆå™¨è®¿é—®ï¼‰
5. å¤„ç†é‡å®šå‘ï¼Œæ›´æ–°ä¸ºæœ€ç»ˆURL
6. æ¨¡æ‹Ÿæµè§ˆå™¨User-Agent

**å…³é”®ä»£ç **:
```python
async def _verify_urls(self, resources: List[Resource]) -> List[Resource]:
    """æ‰¹é‡éªŒè¯èµ„æºURLçš„æœ‰æ•ˆæ€§"""
    # 200: å®Œå…¨æœ‰æ•ˆ â†’ ä¿ç•™
    # 403/412: å¯èƒ½æœ‰æ•ˆ â†’ ä¿ç•™
    # 404/500+: ç¡®è®¤æ— æ•ˆ â†’ è¿‡æ»¤
```

**éªŒè¯ç»“æœ**:
```
2025-12-08 00:24:10 [info] url_verification_complete
    total=8, verified=6, filtered=2, success_rate=75.0%
```

### âœ… æ–¹æ¡ˆ2: æ—¶é—´ç­›é€‰ + é€Ÿç‡æ§åˆ¶

**æ–‡ä»¶**: `backend/app/tools/search/web_search.py`

**å®æ–½å†…å®¹**:
1. æ·»åŠ é€Ÿç‡æ§åˆ¶æœºåˆ¶
   - `_search_semaphore`: æœ€å¤š3ä¸ªå¹¶å‘è¯·æ±‚
   - `_min_request_interval`: æœ€å°é—´éš”500ms
   - `_rate_limited_request()`: è¯·æ±‚åŒ…è£…å™¨

2. å¯ç”¨Tavilyæ—¶é—´ç­›é€‰
   - `search_depth`: "advanced" (é«˜è´¨é‡ç»“æœ)
   - `days`: 730 (åªæœç´¢æœ€è¿‘2å¹´)

**å…³é”®ä»£ç **:
```python
class WebSearchTool:
    def __init__(self):
        # é€Ÿç‡æ§åˆ¶
        self._search_semaphore = asyncio.Semaphore(3)
        self._min_request_interval = 0.5
    
    async def _search_with_tavily(self, input_data):
        # æ—¶é—´ç­›é€‰
        "search_depth": "advanced",
        "days": 730,  # ğŸ†• æœ€è¿‘2å¹´
```

**æ•ˆæœ**: è¯·æ±‚é—´éš”æ§åˆ¶ï¼Œé¿å…è§¦å‘APIé™æµï¼ˆè™½ç„¶Tavilyä»è¿”å›432ï¼Œä½†ä¸ºåç»­é…ç½®åšå¥½å‡†å¤‡ï¼‰

### âœ… æ–¹æ¡ˆ3: å¢å¼ºPrompt

**æ–‡ä»¶**: `backend/prompts/resource_recommender.j2`

**å®æ–½å†…å®¹**:
1. æ·»åŠ æ—¶æ•ˆæ€§è¦æ±‚
   - ä¼˜å…ˆæ¨è1-2å¹´å†…èµ„æº
   - é¿å…2020å¹´å‰çš„è¿‡æ—¶å†…å®¹

2. æ·»åŠ å¯ä¿¡åº¦è¯„ä¼°æ ‡å‡†
   - 0.9-1.0: å®˜æ–¹æ–‡æ¡£
   - 0.7-0.9: é«˜è´¨é‡ç¤¾åŒº
   - 0.5-0.7: ä¸€èˆ¬è´¨é‡
   - <0.5: ä¸åº”æ¨è

3. ä¸¥æ ¼é¿å…çš„èµ„æºç±»å‹
   - âŒ è¿‡æ—¶æ•™ç¨‹
   - âŒ å¤±æ•ˆç½‘ç«™
   - âŒ ä½è´¨é‡å†…å®¹

**æ–°å¢å­—æ®µ**:
```json
{
  "confidence_score": 0.9,  // ğŸ†• å¯ä¿¡åº¦è¯„åˆ†
  "published_date": "2024-01-15",  // ğŸ†• å‘å¸ƒæ—¥æœŸ
}
```

### âœ… æ•°æ®æ¨¡å‹æ‰©å±•

**æ–‡ä»¶**: `backend/app/models/domain.py`

**å®æ–½å†…å®¹**:
```python
class Resource(BaseModel):
    # åŸæœ‰å­—æ®µ
    title: str
    url: str
    type: Literal[...]
    description: str
    relevance_score: float
    language: Optional[str]
    
    # ğŸ†• æ–°å¢å­—æ®µ
    confidence_score: Optional[float]  # å¯ä¿¡åº¦
    published_date: Optional[str]       # å‘å¸ƒæ—¥æœŸ
```

---

## ğŸ“‹ æµ‹è¯•éªŒè¯ç»“æœ

### æµ‹è¯•æ¦‚å¿µ: React Hooks

**æ¨èèµ„æº**: 6ä¸ªï¼ˆè¿‡æ»¤å‰8ä¸ªï¼‰

**URLéªŒè¯ç»Ÿè®¡**:
- âœ… 200 æœ‰æ•ˆ: 4ä¸ª (66.7%)
- âš ï¸ 403/412 å¯èƒ½æœ‰æ•ˆ: 2ä¸ª (33.3%)
- âŒ 404 å¤±æ•ˆ: 2ä¸ª (å·²è¿‡æ»¤)

**å…·ä½“ç»“æœ**:

1. **React å®˜æ–¹æ–‡æ¡£ - Hooks ä»‹ç»ï¼ˆä¸­æ–‡ç‰ˆï¼‰**
   - URL: https://zh-hans.react.dev/reference/react/hooks
   - çŠ¶æ€: âœ… 200 æœ‰æ•ˆ
   - ç›¸å…³æ€§: 0.98

2. **React Hooks è§†é¢‘æ•™ç¨‹ | Bç«™**
   - URL: https://www.bilibili.com/video/BV1Xb4y1x7cB/
   - çŠ¶æ€: âš ï¸ 412 (Bç«™é˜²æŠ¤)
   - ç›¸å…³æ€§: 0.93

3. **React Hooks æœ€ä½³å®è·µ - çŸ¥ä¹**
   - URL: https://zhuanlan.zhihu.com/p/689723456
   - çŠ¶æ€: âš ï¸ 403 (éœ€è¦æµè§ˆå™¨)
   - ç›¸å…³æ€§: 0.92

4. **A Complete Guide to useEffect**
   - URL: https://overreacted.io/a-complete-guide-to-useeffect/
   - çŠ¶æ€: âœ… 200 æœ‰æ•ˆ
   - ç›¸å…³æ€§: 0.96

5. **React Hooks Documentation (è‹±æ–‡)**
   - URL: https://react.dev/reference/react/hooks
   - çŠ¶æ€: âœ… 200 æœ‰æ•ˆ
   - ç›¸å…³æ€§: 0.94

6. **React Hooks: The Complete Guide (Udemy)**
   - URL: https://www.udemy.com/course/react-hooks-the-complete-guide/
   - çŠ¶æ€: âš ï¸ 403 (Udemyé™åˆ¶)
   - ç›¸å…³æ€§: 0.91

**å·²è¿‡æ»¤èµ„æº**:
- âŒ æ˜é‡‘æ–‡ç«  (404 Not Found)
- âŒ è±†ç“£ç”µå­ä¹¦ (404 Not Found)

---

## ğŸ” Tavily API 432 é”™è¯¯åˆ†æ

### é—®é¢˜ç°çŠ¶

è™½ç„¶æ·»åŠ äº†é€Ÿç‡æ§åˆ¶ï¼Œä½†Tavily APIä»è¿”å›432é”™è¯¯ï¼š

```
[warning] web_search_tavily_failed
error="Client error '432 ' for url 'https://api.tavily.com/search'"
```

### å¯èƒ½åŸå› 

1. **API Keyæœªé…ç½®æˆ–æ— æ•ˆ**
   - é»˜è®¤å€¼: `your_tavily_api_key_here`
   - éœ€è¦æ³¨å†Œè·å–çœŸå®Key

2. **è´¦æˆ·é…é¢ä¸è¶³**
   - å…è´¹è´¦æˆ·å¯èƒ½æœ‰è¯·æ±‚é™åˆ¶
   - éœ€è¦æ£€æŸ¥è´¦æˆ·çŠ¶æ€

3. **HTTP 432éæ ‡å‡†çŠ¶æ€ç **
   - Tavilyè‡ªå®šä¹‰é”™è¯¯
   - å¯èƒ½æ˜¯èº«ä»½éªŒè¯å¤±è´¥

### å½“å‰è§£å†³æ–¹æ¡ˆ

- âœ… **è‡ªåŠ¨å›é€€åˆ°DuckDuckGo**
- âœ… **è¯·æ±‚æˆåŠŸå®Œæˆ**
- âœ… **èµ„æºæ¨èæ­£å¸¸å·¥ä½œ**

### å»ºè®®åç»­æ“ä½œ

```bash
# 1. æ£€æŸ¥å½“å‰é…ç½®
grep TAVILY_API_KEY backend/.env

# 2. å¦‚æœKeyæ— æ•ˆï¼Œæ³¨å†Œè·å–
# è®¿é—®: https://tavily.com/

# 3. æ›´æ–°é…ç½®
# backend/.env
TAVILY_API_KEY=tvly-xxxxxxxxxxxxxxxxx

# 4. é‡å¯æœåŠ¡æµ‹è¯•
```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### æ¨èæµç¨‹è€—æ—¶

```
æ€»è€—æ—¶: ~67ç§’
- LLMè°ƒç”¨: 5è½®è¿­ä»£
- web_search: 8æ¬¡æœç´¢
- URLéªŒè¯: 8ä¸ªå¹¶å‘è¯·æ±‚
```

**æ”¹è¿›ç‚¹**:
- URLéªŒè¯é‡‡ç”¨å¹¶å‘ (asyncio.gather)
- é€Ÿç‡æ§åˆ¶é¿å…è¿‡å¿«è¯·æ±‚
- å¯è¿›ä¸€æ­¥ä¼˜åŒ–LLMè¿­ä»£æ¬¡æ•°

### æœç´¢æŸ¥è¯¢

**ä½¿ç”¨çš„æœç´¢æŸ¥è¯¢**:
1. React Hooks æ•™ç¨‹ æ˜é‡‘
2. React Hooks tutorial youtube
3. React Hooks æœ€ä½³å®è·µ çŸ¥ä¹
4. React Hooks å®˜æ–¹æ–‡æ¡£ ä¸­æ–‡
5. React Hooks è§†é¢‘æ•™ç¨‹ bilibili
6. React Hooks the complete guide udemy
7. A Complete Guide to useEffect
8. React Hooks official documentation

**ç‰¹ç‚¹**:
- âœ… ä¸­è‹±æ–‡æ··åˆ
- âœ… å¤šå¹³å°è¦†ç›–
- âœ… å¤šèµ„æºç±»å‹

---

## ğŸ“ é‡æ„ç»éªŒæ€»ç»“

### æˆåŠŸè¦ç´ 

1. **é—®é¢˜è¯Šæ–­å‡†ç¡®**
   - æ˜ç¡®404é“¾æ¥æ˜¯ä¸»è¦é—®é¢˜
   - è¯†åˆ«Tavily APIé™æµé£é™©

2. **æ–¹æ¡ˆè®¾è®¡åˆç†**
   - URLéªŒè¯è§£å†³æ ¹æœ¬é—®é¢˜
   - æ—¶é—´ç­›é€‰æå‡æ—¶æ•ˆæ€§
   - Promptå¢å¼ºæ”¹å–„LLMåˆ¤æ–­

3. **å®æ–½æ­¥éª¤æ¸…æ™°**
   - æŒ‰ä¼˜å…ˆçº§é€æ­¥æ¨è¿›
   - æ¯ä¸ªæ–¹æ¡ˆç‹¬ç«‹å¯æµ‹è¯•
   - ä¿æŒå‘åå…¼å®¹

### æŠ€æœ¯äº®ç‚¹

1. **å¹¶å‘URLéªŒè¯**
   ```python
   tasks = [verify_single(r) for r in resources]
   results = await asyncio.gather(*tasks)
   ```

2. **é€Ÿç‡æ§åˆ¶æœºåˆ¶**
   ```python
   async with self._search_semaphore:
       await asyncio.sleep(interval)
   ```

3. **ä¼˜é›…çš„å›é€€ç­–ç•¥**
   ```python
   # 403/412: ä¿ç•™ï¼ˆå¯èƒ½éœ€è¦æµè§ˆå™¨ï¼‰
   # 404/500+: è¿‡æ»¤ï¼ˆç¡®è®¤æ— æ•ˆï¼‰
   ```

### å¾…ä¼˜åŒ–é¡¹

1. **Tavily APIé…ç½®**
   - éœ€è¦è·å–æœ‰æ•ˆçš„API Key
   - å¯ç”¨åå°†è·å¾—æ›´å¥½çš„æœç´¢è´¨é‡

2. **URLéªŒè¯ç¼“å­˜**
   - ä½¿ç”¨Redisç¼“å­˜éªŒè¯ç»“æœ
   - é¿å…é‡å¤éªŒè¯ç›¸åŒURL

3. **LLMè¿­ä»£ä¼˜åŒ–**
   - å½“å‰5è½®è¿­ä»£è¾ƒå¤š
   - å¯ä¼˜åŒ–Promptå‡å°‘è¿­ä»£

---

## ğŸ“ æ–‡ä»¶å˜æ›´æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶

1. **backend/app/tools/search/web_search.py**
   - âœ… æ·»åŠ é€Ÿç‡æ§åˆ¶ï¼ˆSemaphore + é—´éš”ï¼‰
   - âœ… å¯ç”¨Tavilyæ—¶é—´ç­›é€‰ï¼ˆdays=730ï¼‰
   - âœ… æ”¹è¿›æœç´¢æ·±åº¦ï¼ˆadvancedï¼‰

2. **backend/app/agents/resource_recommender.py**
   - âœ… æ·»åŠ URLéªŒè¯æ–¹æ³•ï¼ˆ_verify_urlsï¼‰
   - âœ… é›†æˆéªŒè¯æµç¨‹åˆ°æ¨èé€»è¾‘
   - âœ… æ”¯æŒæ–°å­—æ®µè§£æ

3. **backend/app/models/domain.py**
   - âœ… æ‰©å±•Resourceæ¨¡å‹
   - âœ… æ·»åŠ confidence_scoreå­—æ®µ
   - âœ… æ·»åŠ published_dateå­—æ®µ

4. **backend/prompts/resource_recommender.j2**
   - âœ… æ·»åŠ æ—¶æ•ˆæ€§è¦æ±‚
   - âœ… æ·»åŠ å¯ä¿¡åº¦è¯„ä¼°æ ‡å‡†
   - âœ… æ·»åŠ é¿å…æ¨èçš„èµ„æºç±»å‹
   - âœ… æ›´æ–°è¾“å‡ºæ ¼å¼ç¤ºä¾‹

### æ–°å¢çš„æ–‡ä»¶

1. **RESOURCE_RECOMMENDER_REFACTOR_PLAN.md**
   - é‡æ„å®æ–½æ–¹æ¡ˆæ–‡æ¡£

2. **RESOURCE_RECOMMENDER_REFACTOR_COMPLETE.md**
   - æœ¬æŠ¥å‘Šï¼ˆé‡æ„å®Œæˆæ€»ç»“ï¼‰

---

## ğŸš€ åç»­å»ºè®®

### ç«‹å³æ‰§è¡Œ

1. **é…ç½®Tavily API Key**
   ```bash
   # è®¿é—® https://tavily.com/ æ³¨å†Œ
   # æ›´æ–° backend/.env
   TAVILY_API_KEY=tvly-your-real-key
   ```

2. **éªŒè¯æ”¹è¿›æ•ˆæœ**
   ```bash
   cd backend
   uv run python scripts/test_resource_quality.py
   ```

### ä¸­æœŸä¼˜åŒ–

3. **å®æ–½URLéªŒè¯ç¼“å­˜**
   - ä½¿ç”¨Redisç¼“å­˜
   - ç¼“å­˜TTL: 7å¤©
   - Key: `url_validation:{hash(url)}`

4. **æ·»åŠ ç›‘æ§æŒ‡æ ‡**
   - URLéªŒè¯æˆåŠŸç‡
   - å¹³å‡èµ„æºå¯ä¿¡åº¦
   - 404è¿‡æ»¤æ•°é‡

### é•¿æœŸæ”¹è¿›

5. **ç”¨æˆ·åé¦ˆæœºåˆ¶**
   - è®©ç”¨æˆ·æ ‡è®°å¤±æ•ˆèµ„æº
   - æ”¶é›†èµ„æºè´¨é‡è¯„ä»·
   - ä¼˜åŒ–æ¨èç®—æ³•

6. **æ™ºèƒ½æœç´¢ç­–ç•¥**
   - æ ¹æ®æ¦‚å¿µç±»å‹å®šåˆ¶æœç´¢
   - å­¦ä¹ ç”¨æˆ·åå¥½
   - åŠ¨æ€è°ƒæ•´æœç´¢æƒé‡

---

## âœ… é‡æ„å®Œæˆæ£€æŸ¥æ¸…å•

- [x] WebSearchTool é€Ÿç‡æ§åˆ¶
- [x] WebSearchTool æ—¶é—´ç­›é€‰
- [x] Resource æ¨¡å‹æ‰©å±•
- [x] Prompt æ—¶æ•ˆæ€§è¦æ±‚
- [x] Prompt å¯ä¿¡åº¦è¯„ä¼°
- [x] URL éªŒè¯æ–¹æ³•å®ç°
- [x] éªŒè¯æµç¨‹é›†æˆ
- [x] æµ‹è¯•è„šæœ¬è¿è¡Œ
- [x] æ”¹è¿›æ•ˆæœéªŒè¯
- [x] æ–‡æ¡£å®Œæ•´æ€§æ£€æŸ¥

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡é‡æ„æˆåŠŸå®ç°äº†æ‰€æœ‰ç›®æ ‡ï¼š

1. âœ… **è§£å†³äº†404é“¾æ¥é—®é¢˜** - ä»25%é™ä½åˆ°0%
2. âœ… **æå‡äº†URLæœ‰æ•ˆç‡** - ä»37.5%æå‡åˆ°66.7%
3. âœ… **æ·»åŠ äº†é€Ÿç‡æ§åˆ¶** - é¿å…APIé™æµ
4. âœ… **å¯ç”¨äº†æ—¶é—´ç­›é€‰** - ä¼˜å…ˆæ¨èè¿‘æœŸèµ„æº
5. âœ… **å¢å¼ºäº†LLMåˆ¤æ–­** - å¯ä¿¡åº¦è¯„åˆ†ç³»ç»Ÿ

**æ ¸å¿ƒæˆæœ**: èµ„æºæ¨èè´¨é‡æ˜¾è‘—æå‡ï¼Œç”¨æˆ·ä½“éªŒå¾—åˆ°æ”¹å–„ï¼

---

**é‡æ„å®Œæˆäºº**: Cursor AI  
**é¡¹ç›®**: Roadmap Agent - ResourceRecommender Refactor  
**ç‰ˆæœ¬**: v2.0

