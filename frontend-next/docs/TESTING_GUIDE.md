# 端到端测试指南

## 🎯 测试目标

确保前端与后端完全集成,核心用户流程可正常运行。

## 📋 测试前准备

### 1. 启动后端服务

```bash
cd backend
./scripts/start_dev.sh
```

等待服务启动完成,确认以下服务运行正常:
- FastAPI 服务: http://localhost:8000
- PostgreSQL 数据库
- MinIO/S3 存储服务

### 2. 生成前端类型

```bash
cd frontend-next
npm run generate:types
```

验证 `types/generated/` 目录有最新类型文件。

### 3. 启动前端服务

```bash
npm run dev
```

打开浏览器: http://localhost:3000/app/home

## 🧪 测试用例

### 测试用例 1: 路线图生成流程 ✅

**目标**: 验证从创建到查看的完整流程

**步骤**:

1. 访问 http://localhost:3000/app/home
2. 点击"创建路线图"按钮
3. 填写表单:
   - **学习目标**: "学习 React 和 Next.js"
   - **当前水平**: 选择"初学者"
   - **每周学习时间**: 输入 10 小时
   - **学习动机**: "想要成为全栈工程师"
   - **职业背景**: "计算机科学本科"
   - **内容偏好**: 勾选"视频"和"项目"
4. 点击"生成路线图"按钮

**预期结果**:
- ✅ 显示"正在分析学习需求..."
- ✅ 显示 Agent 实时输出内容
- ✅ 切换到"正在设计课程框架..."
- ✅ 显示"正在生成教程内容..."
- ✅ 显示教程批次进度条
- ✅ 显示小方块进度指示器(绿色=完成,灰色=待完成)
- ✅ 整体进度从 0% 增长到 100%
- ✅ 显示"生成完成!"
- ✅ 自动跳转到路线图详情页

**异常处理**:
- 如果生成失败,显示错误提示
- 可以返回首页重试

---

### 测试用例 2: 路线图查看流程 ✅

**目标**: 验证路线图详情展示和导航

**步骤**:

1. 在路线图详情页
2. 检查页面元素:
   - 路线图标题
   - 总学习时间
   - 推荐完成时间
   - 学习进度条
3. 检查列表视图:
   - 展开/折叠 Stage
   - 展开/折叠 Module
   - 查看 Concept 列表
4. 点击某个 Concept

**预期结果**:
- ✅ 正确显示路线图元数据
- ✅ Stage/Module 折叠展开正常
- ✅ Concept 显示状态图标(完成/生成中/待生成)
- ✅ 进度条正确反映完成度
- ✅ 点击 Concept 打开教程对话框

**异常处理**:
- 如果加载失败,显示"加载失败"和"重试"按钮
- 点击重试可重新加载

---

### 测试用例 3: 教程查看流程 ✅

**目标**: 验证教程内容展示

**步骤**:

1. 在路线图详情页点击任意 Concept
2. 等待教程对话框打开
3. 检查"教程内容" Tab:
   - Markdown 内容渲染
   - 代码块语法高亮
   - 链接可点击
4. 切换到"学习资源" Tab
5. 切换到"练习测验" Tab
6. 切换到"版本历史" Tab
7. 点击"重新生成"按钮
8. 点击"修改内容"按钮(如果实现)
9. 点击"关闭"按钮

**预期结果**:
- ✅ 对话框正常打开
- ✅ 教程内容正确渲染
- ✅ 资源列表显示(如果有)
- ✅ 测验题目显示(如果有)
- ✅ 版本历史显示所有版本
- ✅ 重新生成功能正常工作
- ✅ 关闭对话框返回详情页

**异常处理**:
- 如果教程内容加载失败,显示"加载内容失败"
- 如果 S3 URL 过期,提示用户刷新

---

### 测试用例 4: 聊天式修改流程 ⏳

**目标**: 验证聊天式修改功能(需要在详情页集成)

**步骤**:

1. 在路线图详情页点击"Chat"按钮(需要实现)
2. 打开聊天修改面板
3. 输入修改请求: "把 React Hooks 教程改得更详细一些"
4. 点击"发送"按钮
5. 观察意图分析过程
6. 观察修改执行过程
7. 查看修改结果

**预期结果**:
- ✅ 显示"正在分析修改意图..."
- ✅ 显示检测到的意图列表
- ✅ 显示"正在执行修改..."
- ✅ 显示每个修改的结果(成功/失败)
- ✅ 显示"修改完成"
- ✅ 刷新受影响的教程

**异常处理**:
- 如果意图不明确,显示"需要更多信息"和澄清问题
- 如果修改失败,显示具体错误信息

---

### 测试用例 5: 历史记录流程 ✅

**目标**: 验证历史记录功能

**步骤**:

1. 生成至少 2 个路线图
2. 返回首页 http://localhost:3000/app/home
3. 检查"我的路线图"列表
4. 点击某个历史路线图卡片

**预期结果**:
- ✅ 历史记录列表显示所有生成的路线图
- ✅ 显示路线图标题、进度、创建时间
- ✅ 点击卡片跳转到对应详情页

**异常处理**:
- 如果没有历史记录,显示"还没有路线图"和"创建路线图"按钮

---

### 测试用例 6: 重新生成功能 ✅

**目标**: 验证教程重新生成

**步骤**:

1. 打开任意教程对话框
2. 点击"重新生成"按钮
3. 确认操作
4. 等待重新生成完成

**预期结果**:
- ✅ 显示确认提示: "确定要重新生成这个教程吗?"
- ✅ 显示加载状态
- ✅ 重新生成成功后刷新内容
- ✅ 版本历史中增加新版本
- ✅ 显示成功提示: "重新生成成功! 新版本: v2"

**异常处理**:
- 如果重新生成失败,显示错误提示
- 原有内容保持不变

---

### 测试用例 7: 版本历史 ✅

**目标**: 验证版本历史查看

**步骤**:

1. 生成一个路线图
2. 打开某个教程对话框
3. 重新生成教程(创建 v2)
4. 切换到"版本历史" Tab

**预期结果**:
- ✅ 显示所有版本列表
- ✅ 当前版本标记为"当前版本"
- ✅ 每个版本显示:
  - 标题
  - 摘要
  - 生成时间
  - 版本号
  - 状态
- ✅ 可以点击外部链接查看历史版本内容

**异常处理**:
- 如果没有历史版本,显示"暂无版本历史"

---

## ⚠️ 已知问题

1. **类型生成依赖后端**
   - 后端必须运行才能生成类型
   - 首次开发建议先启动后端

2. **S3 URL 时效性**
   - 教程内容 URL 可能过期
   - 需要刷新页面重新获取

3. **CORS 配置**
   - 确保后端允许 `http://localhost:3000`

4. **用户认证未实现**
   - 当前使用硬编码的 `temp-user-001`

## ✅ 验收标准

系统通过测试的标准:

- [x] 测试用例 1: 路线图生成 ✅
- [x] 测试用例 2: 路线图查看 ✅
- [x] 测试用例 3: 教程查看 ✅
- [ ] 测试用例 4: 聊天式修改 ⏳ (UI 已完成,需要集成到详情页)
- [x] 测试用例 5: 历史记录 ✅
- [x] 测试用例 6: 重新生成 ✅
- [x] 测试用例 7: 版本历史 ✅

**当前状态**: 6/7 完成 (85.7%)

## 🐛 如何报告 Bug

如果发现问题,请记录:

1. **复现步骤**: 详细描述操作步骤
2. **预期结果**: 应该发生什么
3. **实际结果**: 实际发生了什么
4. **错误信息**: 浏览器控制台错误、后端日志
5. **环境信息**: 浏览器版本、Node 版本、后端版本

## 📊 测试报告模板

```markdown
# 测试报告 - YYYY-MM-DD

## 测试环境
- 后端版本: xxx
- 前端版本: xxx
- Node.js: v18.x
- 浏览器: Chrome 120

## 测试结果
- ✅ 测试用例 1: 通过
- ✅ 测试用例 2: 通过
- ❌ 测试用例 3: 失败 (教程内容加载失败)
- ...

## 发现的问题
1. 教程内容 S3 URL 过期
   - 复现率: 偶发
   - 优先级: P1
   
2. ...

## 建议
1. 增加 S3 URL 有效期
2. ...
```

---

**最后更新**: 2025-11-30
**维护者**: QA Team

