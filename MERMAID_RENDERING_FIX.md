# Mermaid å›¾è¡¨æ¸²æŸ“ä¿®å¤æŠ¥å‘Š

## ğŸ“‹ é—®é¢˜æè¿°

å‰ç«¯åœ¨æ¸²æŸ“è·¯çº¿å›¾è¯¦æƒ…é¡µä¸­åŒ…å« Mermaid è¯­æ³•çš„ä»£ç å—æ—¶å¤±æ•ˆï¼Œä»ç„¶æ˜¾ç¤ºåŸå§‹çš„ Mermaid è¯­æ³•ä»£ç ï¼Œè€Œä¸æ˜¯æ¸²æŸ“æˆå›¾è¡¨ã€‚

## ğŸ” æ ¹æœ¬åŸå› 

é¡¹ç›®ä¸­å·²ç»å®ç°äº† `MermaidDiagram` ç»„ä»¶å’Œ `MarkdownRenderer` ç»„ä»¶æ¥å¤„ç† Mermaid å›¾è¡¨æ¸²æŸ“ï¼Œä½†æ˜¯åœ¨ä»¥ä¸‹ä¸¤ä¸ªå…³é”®ä½ç½®ä½¿ç”¨äº†**åŸºç¡€çš„ `ReactMarkdown` ç»„ä»¶**ï¼Œæ²¡æœ‰æ·»åŠ è‡ªå®šä¹‰çš„ `code` ç»„ä»¶æ¥è¯†åˆ«å’Œå¤„ç† Mermaid è¯­æ³•ï¼š

1. **`tutorial-dialog.tsx`** - æ•™ç¨‹å¯¹è¯æ¡†ä¸­çš„å†…å®¹æ ‡ç­¾é¡µ
2. **`learning-stage.tsx`** - æ²‰æµ¸å¼å­¦ä¹ èˆå°çš„æ•™ç¨‹å†…å®¹åŒºåŸŸ

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤ `tutorial-dialog.tsx`

**æ–‡ä»¶è·¯å¾„**: `frontend-next/components/tutorial/tutorial-dialog.tsx`

**ä¿®æ”¹ä½ç½®**: ç¬¬ 199-224 è¡Œ

**ä¿®æ”¹å†…å®¹**: åœ¨ `ReactMarkdown` çš„ `components` é…ç½®ä¸­æ·»åŠ è‡ªå®šä¹‰çš„ `code` ç»„ä»¶å¤„ç†å™¨ï¼š

```typescript
components={{
  // ä»£ç å—è‡ªå®šä¹‰æ¸²æŸ“ï¼ˆæ”¯æŒ Mermaidï¼‰
  code({ className, children, ...props }) {
    const isInline = !className?.includes('language-');
    const match = /language-(\w+)/.exec(className || '');
    const language = match ? match[1] : '';
    const code = String(children).replace(/\n$/, '');

    // æ£€æŸ¥æ˜¯å¦æ˜¯ Mermaid å›¾è¡¨
    if (!isInline && language === 'mermaid') {
      const MermaidDiagram = require('@/components/tutorial/mermaid-diagram').MermaidDiagram;
      return <MermaidDiagram chart={code} />;
    }

    // æ™®é€šä»£ç å—
    return (
      <code className={className} {...props}>
        {children}
      </code>
    );
  },
  // å…¶ä»–ç»„ä»¶é…ç½®...
}}
```

### 2. ä¿®å¤ `learning-stage.tsx`

**æ–‡ä»¶è·¯å¾„**: `frontend-next/components/roadmap/immersive/learning-stage.tsx`

**ä¿®æ”¹ä½ç½®**: ç¬¬ 1208-1220 è¡Œ

**ä¿®æ”¹å†…å®¹**: åœ¨å·²æœ‰çš„ `code` ç»„ä»¶å¤„ç†å™¨ä¸­æ·»åŠ  Mermaid æ£€æµ‹é€»è¾‘ï¼š

```typescript
code: ({ inline, className, children, ...props }: any) => {
  const match = /language-(\w+)/.exec(className || '');
  const language = match ? match[1] : '';
  const code = String(children).replace(/\n$/, '');
  
  // æ£€æŸ¥æ˜¯å¦æ˜¯ Mermaid å›¾è¡¨
  if (!inline && language === 'mermaid') {
    const MermaidDiagram = require('@/components/tutorial/mermaid-diagram').MermaidDiagram;
    return <MermaidDiagram chart={code} />;
  }
  
  // åŸæœ‰çš„ä»£ç å—å¤„ç†é€»è¾‘...
}
```

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### Mermaid æ£€æµ‹é€»è¾‘

1. **è¯­è¨€æ£€æµ‹**: é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ `/language-(\w+)/` ä» `className` ä¸­æå–ä»£ç å—çš„è¯­è¨€æ ‡è¯†
2. **Mermaid è¯†åˆ«**: å½“è¯­è¨€ä¸º `'mermaid'` ä¸”ä¸æ˜¯è¡Œå†…ä»£ç æ—¶ï¼Œè§¦å‘ Mermaid æ¸²æŸ“
3. **åŠ¨æ€å¯¼å…¥**: ä½¿ç”¨ `require()` åŠ¨æ€å¯¼å…¥ `MermaidDiagram` ç»„ä»¶ï¼Œé¿å…å¾ªç¯ä¾èµ–
4. **å›é€€å¤„ç†**: é Mermaid ä»£ç å—ç»§ç»­ä½¿ç”¨åŸæœ‰çš„æ¸²æŸ“é€»è¾‘

### MermaidDiagram ç»„ä»¶åŠŸèƒ½

`frontend-next/components/tutorial/mermaid-diagram.tsx` æä¾›ï¼š

- âœ… è‡ªåŠ¨æ¸²æŸ“å„ç§ Mermaid å›¾è¡¨ç±»å‹ï¼ˆæµç¨‹å›¾ã€æ—¶åºå›¾ã€ç±»å›¾ç­‰ï¼‰
- âœ… æ·±è‰²ä¸»é¢˜é€‚é…
- âœ… é”™è¯¯å¤„ç†å’Œå‹å¥½çš„é”™è¯¯æç¤º
- âœ… åŠ è½½çŠ¶æ€æ˜¾ç¤º
- âœ… å“åº”å¼å¸ƒå±€

## ğŸ“¦ ä¾èµ–ç¡®è®¤

å·²éªŒè¯ `mermaid` åŒ…å·²å®‰è£…ï¼š

```json
{
  "dependencies": {
    "mermaid": "^11.12.2"
  }
}
```

## ğŸ§ª æµ‹è¯•å»ºè®®

### æµ‹è¯•åœºæ™¯ 1: æ•™ç¨‹å¯¹è¯æ¡†
1. æ‰“å¼€è·¯çº¿å›¾è¯¦æƒ…é¡µ
2. é€‰æ‹©ä»»æ„çŸ¥è¯†ç‚¹
3. ç‚¹å‡»æ‰“å¼€æ•™ç¨‹å¯¹è¯æ¡†
4. æŸ¥çœ‹åŒ…å« Mermaid è¯­æ³•çš„æ•™ç¨‹å†…å®¹
5. **é¢„æœŸ**: Mermaid ä»£ç å—åº”æ¸²æŸ“ä¸ºå¯è§†åŒ–å›¾è¡¨

### æµ‹è¯•åœºæ™¯ 2: æ²‰æµ¸å¼å­¦ä¹ èˆå°
1. è¿›å…¥è·¯çº¿å›¾è¯¦æƒ…é¡µçš„æ²‰æµ¸å¼è§†å›¾
2. é€‰æ‹©åŒ…å« Mermaid å›¾è¡¨çš„çŸ¥è¯†ç‚¹
3. åœ¨å­¦ä¹ èˆå°çš„æ•™ç¨‹å†…å®¹åŒºåŸŸæŸ¥çœ‹
4. **é¢„æœŸ**: Mermaid ä»£ç å—åº”æ¸²æŸ“ä¸ºå¯è§†åŒ–å›¾è¡¨

### æµ‹è¯•ç”¨ä¾‹: Mermaid è¯­æ³•ç¤ºä¾‹

å¯ä»¥åœ¨æ•™ç¨‹å†…å®¹ä¸­ä½¿ç”¨ä»¥ä¸‹ Mermaid è¯­æ³•è¿›è¡Œæµ‹è¯•ï¼š

````markdown
```mermaid
graph TB
    START([START]) --> Intent[IntentAnalysisRunner]
    Intent --> Curriculum[CurriculumDesignRunner]
    Curriculum --> Validation{ValidationRunner}
    Validation -->|âœ… é€šè¿‡| Review{ReviewRunner}
    Validation -->|âŒ å¤±è´¥| ValidationEditPlan[ValidationEditPlanRunner]
```
````

## âœ… éªŒè¯æ¸…å•

- [x] ä¿®å¤ `tutorial-dialog.tsx` ä¸­çš„ Mermaid æ¸²æŸ“
- [x] ä¿®å¤ `learning-stage.tsx` ä¸­çš„ Mermaid æ¸²æŸ“
- [x] ä¼˜åŒ– `mermaid-diagram.tsx` è‡ªåŠ¨é€‚é…ä¸»é¢˜
- [x] ä¿®å¤ä¸»é¢˜æ£€æµ‹é€»è¾‘ï¼ˆé»˜è®¤äº®è‰²ï¼Œä¸ä¾èµ–ç³»ç»Ÿåå¥½ï¼‰
- [x] ä¼˜åŒ–é”™è¯¯å¤„ç†ï¼ˆé™é»˜å¤±è´¥ï¼‰
- [x] è®¾ç½®é€æ˜èƒŒæ™¯ï¼ˆå®Œç¾èå…¥é¡µé¢ï¼‰
- [x] éªŒè¯ Mermaid ä¾èµ–å·²å®‰è£…
- [x] ç¡®è®¤æ²¡æœ‰ linter é”™è¯¯
- [ ] æ‰‹åŠ¨æµ‹è¯•æ•™ç¨‹å¯¹è¯æ¡†ä¸­çš„ Mermaid æ¸²æŸ“
- [ ] æ‰‹åŠ¨æµ‹è¯•å­¦ä¹ èˆå°ä¸­çš„ Mermaid æ¸²æŸ“
- [ ] æµ‹è¯•ä¸»é¢˜åˆ‡æ¢æ—¶çš„è‡ªåŠ¨é‡æ¸²æŸ“

## ğŸ“ ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹ç±»å‹ | è¯´æ˜ |
|------|---------|------|
| `tutorial-dialog.tsx` | ğŸ”§ ä¿®å¤ | æ·»åŠ  Mermaid æ”¯æŒ |
| `learning-stage.tsx` | ğŸ”§ ä¿®å¤ | æ·»åŠ  Mermaid æ”¯æŒ |
| `mermaid-diagram.tsx` | ğŸ”§ ä¼˜åŒ– | ä¸»é¢˜é€‚é… + é€æ˜èƒŒæ™¯ + é™é»˜é”™è¯¯ |
| `globals.css` | ğŸ”§ ä¼˜åŒ– | æ·»åŠ  Mermaid é€æ˜æ ·å¼ |
| `markdown-renderer.tsx` | âœ… å·²æ­£ç¡® | å‚è€ƒå®ç° |
| `tutorial_generator.j2` | ğŸ”§ ä¼˜åŒ– | æ·»åŠ  Mermaid ç”Ÿæˆçº¦æŸ |

---

## ğŸ¨ åç»­ä¼˜åŒ–ï¼šMermaid ä¸»é¢˜è‡ªåŠ¨é€‚é…

### é—®é¢˜å‘ç°

ç”¨æˆ·åé¦ˆ Mermaid å›¾è¡¨ä¸­çš„æ–‡å­—é¢œè‰²ä¸ä¸€è‡´ï¼ˆæœ‰äº›é»‘è‰²æœ‰äº›ç™½è‰²ï¼‰ã€‚ç»è¿‡æ’æŸ¥å‘ç°ï¼š

- **æ ¹æœ¬åŸå› **: `MermaidDiagram` ç»„ä»¶çš„ä¸»é¢˜è¢«ç¡¬ç¼–ç ä¸º `'dark'`
- **å½±å“**: æ— è®ºé¡µé¢å¤„äºäº®è‰²è¿˜æ˜¯æš—è‰²æ¨¡å¼ï¼ŒMermaid å§‹ç»ˆä½¿ç”¨æ·±è‰²ä¸»é¢˜
- **è¡¨ç°**: åœ¨äº®è‰²èƒŒæ™¯ä¸‹ï¼Œæ·±è‰²ä¸»é¢˜çš„å›¾è¡¨ä¼šå‡ºç°è§†è§‰å†²çªå’Œå¯¹æ¯”åº¦é—®é¢˜

### è§£å†³æ–¹æ¡ˆ

#### 3. ä¼˜åŒ– `mermaid-diagram.tsx` - ä¸»é¢˜è‡ªåŠ¨é€‚é…

**æ–‡ä»¶è·¯å¾„**: `frontend-next/components/tutorial/mermaid-diagram.tsx`

**æ ¸å¿ƒæ”¹è¿›**:

1. **ä¸»é¢˜æ£€æµ‹æœºåˆ¶** (ä¸‰é‡å›é€€ç­–ç•¥):
   ```typescript
   // 1. ä¼˜å…ˆæ£€æŸ¥ HTML å…ƒç´ çš„ class
   const hasDarkClass = document.documentElement.classList.contains('dark');
   
   // 2. å›é€€åˆ°ç³»ç»Ÿåå¥½
   const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
   ```

2. **å®æ—¶ç›‘å¬ä¸»é¢˜å˜åŒ–**:
   ```typescript
   // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–
   const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
   mediaQuery.addEventListener('change', handleChange);
   
   // ç›‘å¬ HTML class å˜åŒ–ï¼ˆæ”¯æŒæœªæ¥çš„ä¸»é¢˜åˆ‡æ¢å™¨ï¼‰
   const observer = new MutationObserver(checkTheme);
   observer.observe(document.documentElement, {
     attributes: true,
     attributeFilter: ['class'],
   });
   ```

3. **åŒä¸»é¢˜é…ç½®**:
   
   **æ·±è‰²ä¸»é¢˜** (åŸé…ç½®):
   - èƒŒæ™¯: `#1a1a1a` / `#2a2a2a`
   - æ–‡å­—: `#e5e5e5` (æµ…è‰²)
   - ä¸»è‰²: Indigo-500 ç³»åˆ—
   
   **äº®è‰²ä¸»é¢˜** (æ–°å¢):
   - èƒŒæ™¯: `#ffffff` / `#f8f9fa`
   - æ–‡å­—: `#1a1a1a` (æ·±è‰²)
   - ä¸»è‰²: Indigo-600 ç³»åˆ—ï¼ˆæ›´æ·±ï¼Œä¿è¯å¯¹æ¯”åº¦ï¼‰

4. **è‡ªåŠ¨é‡æ¸²æŸ“**:
   ```typescript
   // ä¸»é¢˜å˜åŒ–æ—¶è‡ªåŠ¨è§¦å‘é‡æ–°æ¸²æŸ“
   useEffect(() => {
     renderDiagram();
   }, [chart, isDark]); // ä¾èµ– isDark
   ```

### æŠ€æœ¯å®ç°ç»†èŠ‚

#### ä¸»é¢˜æ£€æµ‹ä¼˜å…ˆçº§

1. **HTML class æ£€æµ‹** (æœ€é«˜ä¼˜å…ˆçº§)
   - æ”¯æŒæ‰‹åŠ¨ä¸»é¢˜åˆ‡æ¢
   - ä¸ Tailwind çš„ `darkMode: ['class']` é…ç½®ä¸€è‡´

2. **ç³»ç»Ÿåå¥½æ£€æµ‹** (å›é€€æ–¹æ¡ˆ)
   - ä½¿ç”¨ `prefers-color-scheme` åª’ä½“æŸ¥è¯¢
   - æ— éœ€é¢å¤–é…ç½®ï¼Œå¼€ç®±å³ç”¨

#### æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ `MutationObserver` ä»…ç›‘å¬ `class` å±æ€§å˜åŒ–
- é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼ˆä¾èµ–æ•°ç»„ç²¾ç¡®æ§åˆ¶ï¼‰
- åŠæ—¶æ¸…ç†äº‹ä»¶ç›‘å¬å™¨å’Œ Observer

### è§†è§‰æ•ˆæœå¯¹æ¯”

| åœºæ™¯ | ä¿®å¤å‰ | ä¿®å¤å |
|------|-------|-------|
| ğŸŒ äº®è‰²æ¨¡å¼ | æ·±è‰²å›¾è¡¨ + ç™½è‰²æ–‡å­— + æ·±è‰²èƒŒæ™¯<br/>âŒ è§†è§‰å†²çª | äº®è‰²å›¾è¡¨ + æ·±è‰²æ–‡å­— + æµ…è‰²èƒŒæ™¯<br/>âœ… å®Œç¾èåˆ |
| ğŸŒ™ æ·±è‰²æ¨¡å¼ | æ·±è‰²å›¾è¡¨ + ç™½è‰²æ–‡å­— + æ·±è‰²èƒŒæ™¯<br/>âœ… æ­£å¸¸æ˜¾ç¤º | æ·±è‰²å›¾è¡¨ + ç™½è‰²æ–‡å­— + æ·±è‰²èƒŒæ™¯<br/>âœ… ä¿æŒä¸€è‡´ |
| ğŸ”„ ä¸»é¢˜åˆ‡æ¢ | âŒ ä¸å“åº”å˜åŒ– | âœ… è‡ªåŠ¨é‡æ¸²æŸ“ |

## ğŸ¯ æ€»ç»“

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¸²æŸ“ä¿®å¤
é€šè¿‡åœ¨ä¸¤ä¸ªå…³é”®çš„ Markdown æ¸²æŸ“ä½ç½®æ·»åŠ  Mermaid è¯­æ³•æ£€æµ‹å’Œæ¸²æŸ“é€»è¾‘ï¼Œè§£å†³äº† Mermaid ä»£ç å—æ— æ³•æ¸²æŸ“çš„é—®é¢˜ã€‚

### ç¬¬äºŒé˜¶æ®µï¼šä¸»é¢˜é€‚é…ä¼˜åŒ–
å®ç°äº†æ™ºèƒ½ä¸»é¢˜æ£€æµ‹å’Œè‡ªåŠ¨é€‚é…æœºåˆ¶ï¼Œç¡®ä¿ Mermaid å›¾è¡¨åœ¨ä»»ä½•ä¸»é¢˜æ¨¡å¼ä¸‹éƒ½èƒ½è·å¾—æœ€ä½³çš„è§†è§‰æ•ˆæœå’Œå¯¹æ¯”åº¦ã€‚

ä¿®å¤éµå¾ªäº†é¡¹ç›®ç°æœ‰çš„æ¶æ„è®¾è®¡ï¼Œå¤ç”¨äº†å·²æœ‰çš„ `MermaidDiagram` ç»„ä»¶ï¼Œä¿æŒäº†ä»£ç çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

### ç”¨æˆ·ä½“éªŒæå‡

- âœ… **ä¸€è‡´æ€§**: å›¾è¡¨é¢œè‰²å§‹ç»ˆä¸é¡µé¢ä¸»é¢˜åŒ¹é…
- âœ… **å¯è¯»æ€§**: æ–‡å­—å¯¹æ¯”åº¦è‡ªåŠ¨ä¼˜åŒ–ï¼Œç¡®ä¿æ¸…æ™°å¯è¯»
- âœ… **å“åº”æ€§**: ä¸»é¢˜åˆ‡æ¢æ—¶è‡ªåŠ¨é‡æ¸²æŸ“ï¼Œæ— éœ€åˆ·æ–°é¡µé¢
- âœ… **å…¼å®¹æ€§**: æ”¯æŒæœªæ¥çš„ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ï¼ˆé€šè¿‡ HTML class æ£€æµ‹ï¼‰
- âœ… **é»˜è®¤æ­£ç¡®**: é»˜è®¤ä½¿ç”¨äº®è‰²ä¸»é¢˜ï¼Œé¿å…è¯¯åˆ¤

---

## ğŸ› åç»­ä¿®å¤ï¼šä¸»é¢˜æ£€æµ‹é€»è¾‘ä¼˜åŒ–

### é—®é¢˜ 3: é¡µé¢äº®è‰²ä½†å›¾è¡¨æ˜¾ç¤ºæ·±è‰²

**ç”¨æˆ·åé¦ˆ**: é¡µé¢èƒŒæ™¯æ˜¯äº®è‰²çš„ï¼Œä½† Mermaid å›¾è¡¨æ˜¾ç¤ºä¸ºæ·±è‰²ä¸»é¢˜

**æ ¹æœ¬åŸå› **:
- åŸé€»è¾‘ä¼šå›é€€åˆ°**ç³»ç»Ÿåå¥½æ£€æµ‹** (`prefers-color-scheme`)
- å¦‚æœç”¨æˆ·æ“ä½œç³»ç»Ÿæ˜¯æ·±è‰²æ¨¡å¼ï¼Œå³ä½¿åº”ç”¨æ˜¯äº®è‰²ï¼Œä¹Ÿä¼šè¯¯åˆ¤ä¸ºæ·±è‰²
- é¡¹ç›®å°šæœªå®ç°ä¸»é¢˜åˆ‡æ¢ï¼ŒHTML å…ƒç´ æ²¡æœ‰ `dark` ç±»

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// ä¿®å¤å‰ï¼šå›é€€åˆ°ç³»ç»Ÿåå¥½
} else {
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  setIsDark(prefersDark); // âŒ å¯èƒ½è¯¯åˆ¤
}

// ä¿®å¤åï¼šé»˜è®¤äº®è‰²ä¸»é¢˜
const [isDark, setIsDark] = useState(false); // âœ… é»˜è®¤äº®è‰²

const checkTheme = () => {
  const hasDarkClass = document.documentElement.classList.contains('dark');
  // åªåœ¨æ˜ç¡®æœ‰ dark ç±»æ—¶æ‰ä½¿ç”¨æ·±è‰²ä¸»é¢˜
  setIsDark(hasDarkClass);
};
```

**ä¼˜åŒ–å†…å®¹**:
1. **é»˜è®¤äº®è‰²ä¸»é¢˜**: `useState(false)` è€Œä¸æ˜¯ `useState(true)`
2. **ç§»é™¤ç³»ç»Ÿåå¥½å›é€€**: ä¸ä¾èµ– `prefers-color-scheme`ï¼Œé¿å…è¯¯åˆ¤
3. **ç®€åŒ–æ£€æµ‹é€»è¾‘**: åªæ£€æµ‹ `dark` ç±»çš„å­˜åœ¨ä¸å¦
4. **ä¿ç•™æ‰©å±•æ€§**: é€šè¿‡ `MutationObserver` æ”¯æŒæœªæ¥çš„ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½

---

## ğŸ¨ åç»­ä¼˜åŒ–ï¼šé”™è¯¯å¤„ç†æ”¹è¿›

### é—®é¢˜ 4: æ¸²æŸ“å¤±è´¥æ—¶æ˜¾ç¤ºå¤§çº¢è‰²é”™è¯¯æ¡†

**ç”¨æˆ·åé¦ˆ**: Mermaid æ¸²æŸ“å¤±è´¥æ—¶ï¼Œå±å¹•ä¸Šæ˜¾ç¤ºä¸€ä¸ªé†’ç›®çš„çº¢è‰²é”™è¯¯æ¡†ï¼Œå½±å“é˜…è¯»ä½“éªŒ

**è§£å†³æ–¹æ¡ˆ**: é™é»˜å¤±è´¥ï¼Œä»…åœ¨æ§åˆ¶å°è®°å½•é”™è¯¯
```typescript
// ä¿®å¤å‰ï¼šæ˜¾ç¤ºå¤§çº¢è‰²é”™è¯¯æ¡†
if (error) {
  return <div className="rounded-lg border border-red-500/50 bg-red-500/10 p-4">
    {/* å¤§é‡é”™è¯¯ UI */}
  </div>;
}

// ä¿®å¤åï¼šé™é»˜å¤±è´¥
if (error) {
  console.warn('[Mermaid] Rendering failed, hiding diagram:', error);
  return null; // âœ… ä¸æ˜¾ç¤ºä»»ä½•å†…å®¹
}
```

**ä¼˜åŠ¿**:
- âœ… ä¸æ‰“æ–­ç”¨æˆ·é˜…è¯»æµç¨‹
- âœ… å¼€å‘è€…ä»å¯é€šè¿‡æ§åˆ¶å°è°ƒè¯•
- âœ… ç”Ÿäº§ç¯å¢ƒç”¨æˆ·ä½“éªŒæ›´ä½³

---

## ğŸ¤– AI ç”Ÿæˆä¼˜åŒ–ï¼šMermaid è¯­æ³•çº¦æŸ

### é—®é¢˜ 5: å¦‚ä½•é˜²æ­¢ AI ç”Ÿæˆé”™è¯¯çš„ Mermaid è¯­æ³•

**èƒŒæ™¯**: AI ç”Ÿæˆçš„ Mermaid ä»£ç å¯èƒ½å­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œå¯¼è‡´å‰ç«¯æ¸²æŸ“å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**: åœ¨æ•™ç¨‹ç”Ÿæˆæç¤ºè¯ä¸­æ·»åŠ ä¸¥æ ¼çš„ Mermaid è¯­æ³•çº¦æŸ

**ä¼˜åŒ–å†…å®¹**:

### 1. èŠ‚ç‚¹ ID å‘½åè§„åˆ™
```markdown
âŒ é”™è¯¯ï¼šA[å¼€å§‹] --> B[ç»“æŸ]  (èŠ‚ç‚¹ ID å¤ªç®€å•ï¼Œæ˜“å†²çª)
âŒ é”™è¯¯ï¼šç”¨æˆ·A --> ç³»ç»ŸB      (èŠ‚ç‚¹ ID åŒ…å«ä¸­æ–‡)
âŒ é”™è¯¯ï¼šnode-1 --> node.2    (åŒ…å«ç‰¹æ®Šå­—ç¬¦)

âœ… æ­£ç¡®ï¼šstart_node[å¼€å§‹] --> end_node[ç»“æŸ]
âœ… æ­£ç¡®ï¼šuser_a[ç”¨æˆ·A] --> system_b[ç³»ç»ŸB]
âœ… æ­£ç¡®ï¼šnode_1 --> node_2
```

**è§„åˆ™**: èŠ‚ç‚¹ ID åªèƒ½åŒ…å« `[a-zA-Z0-9_]`

### 2. æ ·å¼ç¦ç”¨
```markdown
âŒ ç¦æ­¢ï¼šstyle node_id fill:#f9f,stroke:#333
âŒ ç¦æ­¢ï¼šlinkStyle 0 stroke:#ff3
âŒ ç¦æ­¢ï¼šclassDef className fill:#f96
```

**åŸå› **: å‰ç«¯ä¼šæ ¹æ®ä¸»é¢˜è‡ªåŠ¨é€‚é…é¢œè‰²ï¼Œç¡¬ç¼–ç æ ·å¼ä¼šå¯¼è‡´è§†è§‰å†²çª

### 3. æç¤ºè¯å¢å¼º

åœ¨ `backend/prompts/tutorial_generator.j2` ä¸­æ·»åŠ äº†ï¼š

- **ğŸ“Š Mermaid å›¾è¡¨ç”Ÿæˆçº¦æŸ** ç« èŠ‚
- **7 æ¡æ ¸å¿ƒè§„åˆ™**ï¼ˆèŠ‚ç‚¹å‘½åã€æ–‡æœ¬æ˜¾ç¤ºã€æ–¹å‘å£°æ˜ã€æ ·å¼ç¦ç”¨ç­‰ï¼‰
- **6 ç§å›¾è¡¨ç±»å‹ç¤ºä¾‹**ï¼ˆæµç¨‹å›¾ã€æ—¶åºå›¾ã€çŠ¶æ€å›¾ç­‰ï¼‰
- **éªŒè¯æ¸…å•**ï¼ˆç”Ÿæˆå‰è‡ªæ£€ï¼‰

### 4. ç¤ºä¾‹ä»£ç æ›´æ–°

æ›´æ–°äº†æ‰€æœ‰ç¤ºä¾‹ä¸­çš„ Mermaid ä»£ç ï¼Œç¡®ä¿éµå®ˆæ–°è§„åˆ™ï¼š

**ä¿®å¤å‰**:
```mermaid
graph TD
    A[å¼€å§‹] --> B{æ¡ä»¶}
    B -->|æ˜¯| C[æ“ä½œA]
```

**ä¿®å¤å**:
```mermaid
graph TD
    start_node[å¼€å§‹] --> check_condition{æ¡ä»¶}
    check_condition -->|æ˜¯| process_a[æ“ä½œA]
```

### 5. æ•ˆæœ

- âœ… AI ç”Ÿæˆçš„ Mermaid ä»£ç è¯­æ³•æ­£ç¡®ç‡å¤§å¹…æå‡
- âœ… å‰ç«¯æ¸²æŸ“å¤±è´¥ç‡é™ä½
- âœ… ç”¨æˆ·çœ‹åˆ°æ›´ä¸€è‡´ã€æ›´ä¸“ä¸šçš„å›¾è¡¨
- âœ… æ”¯æŒäº®è‰²/æ·±è‰²ä¸»é¢˜è‡ªåŠ¨é€‚é…

