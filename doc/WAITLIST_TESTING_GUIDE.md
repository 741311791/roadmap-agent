# Waitlist é‚€è¯·ç®¡ç†åŠŸèƒ½ - å¿«é€Ÿæµ‹è¯•æŒ‡å—

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd backend
uv run uvicorn app.main:app --reload --port 8000
```

### 2. å¯åŠ¨å‰ç«¯æœåŠ¡

```bash
cd frontend-next
npm run dev
# æˆ–
pnpm dev
```

### 3. è®¿é—®ç®¡ç†é¡µé¢

1. ä½¿ç”¨è¶…çº§ç®¡ç†å‘˜è´¦å·ç™»å½•
2. è®¿é—®ï¼š`http://localhost:3000/admin/waitlist`
3. æˆ–è€…ç‚¹å‡»å·¦ä¾§è¾¹æ çš„ "Admin" â†’ "Waitlist Management"

---

## ğŸ“‹ æµ‹è¯•æ­¥éª¤

### Step 1: æƒé™éªŒè¯æµ‹è¯•

**æµ‹è¯•åœºæ™¯ 1ï¼šæ™®é€šç”¨æˆ·**
1. ä½¿ç”¨éè¶…çº§ç®¡ç†å‘˜è´¦å·ç™»å½•
2. æ£€æŸ¥å·¦ä¾§è¾¹æ  â†’ âŒ åº”è¯¥çœ‹ä¸åˆ° "Admin" åŒºåŸŸ
3. ç›´æ¥è®¿é—® `/admin/waitlist` â†’ âœ… åº”è¯¥è¢«é‡å®šå‘åˆ° `/home`

**æµ‹è¯•åœºæ™¯ 2ï¼šè¶…çº§ç®¡ç†å‘˜**
1. ä½¿ç”¨è¶…çº§ç®¡ç†å‘˜è´¦å·ç™»å½•
2. æ£€æŸ¥å·¦ä¾§è¾¹æ  â†’ âœ… åº”è¯¥çœ‹åˆ° "Admin" åŒºåŸŸå’Œ "Waitlist Management"
3. ç‚¹å‡»è¿›å…¥ â†’ âœ… æ­£å¸¸æ˜¾ç¤ºé¡µé¢

---

### Step 2: æ•°æ®æŸ¥çœ‹æµ‹è¯•

**æµ‹è¯• Tab è¿‡æ»¤**
1. ç‚¹å‡» "All" â†’ æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·
2. ç‚¹å‡» "Pending" â†’ ä»…æ˜¾ç¤ºæœªå‘é€é‚€è¯·çš„ç”¨æˆ·
3. ç‚¹å‡» "Invited" â†’ ä»…æ˜¾ç¤ºå·²å‘é€é‚€è¯·çš„ç”¨æˆ·
4. æ¯ä¸ª Tab çš„ Badge æ•°å­—åº”è¯¥æ­£ç¡®

**æ£€æŸ¥è¡¨æ ¼å†…å®¹**
- Email åˆ—æ­£ç¡®æ˜¾ç¤º
- Source åˆ—æ˜¾ç¤ºæ¥æºï¼ˆlanding_page ç­‰ï¼‰
- Status åˆ—ï¼š
  - Pending ç”¨æˆ·æ˜¾ç¤ºç°è‰² Badge
  - Invited ç”¨æˆ·æ˜¾ç¤ºç»¿è‰² Badge
- Credentials åˆ—ï¼š
  - Pending ç”¨æˆ·æ˜¾ç¤º "â€”"
  - Invited ç”¨æˆ·æ˜¾ç¤ºç”¨æˆ·åã€å¯†ç å’Œè¿‡æœŸæ—¶é—´
- Created åˆ—æ˜¾ç¤ºåˆ›å»ºæ—¶é—´

---

### Step 3: æ‰¹é‡å‘é€æµ‹è¯•

**æµ‹è¯•å‡†å¤‡**
1. ç¡®ä¿æœ‰è‡³å°‘ 2-3 ä¸ª Pending çŠ¶æ€çš„é‚®ç®±
2. å¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥åœ¨é¦–é¡µ Join Waitlist è¡¨å•æ·»åŠ æµ‹è¯•é‚®ç®±

**æµ‹è¯•å…¨é€‰åŠŸèƒ½**
1. ç‚¹å‡» "Select All" Checkbox
2. âœ… æ‰€æœ‰ Pending ç”¨æˆ·åº”è¯¥è¢«é€‰ä¸­
3. âœ… Selected è®¡æ•°åº”è¯¥æ­£ç¡®
4. å†æ¬¡ç‚¹å‡» â†’ âœ… å–æ¶ˆå…¨é€‰

**æµ‹è¯•å•é€‰åŠŸèƒ½**
1. æ‰‹åŠ¨å‹¾é€‰ 1-2 ä¸ªç”¨æˆ·
2. âœ… Selected è®¡æ•°æ›´æ–°
3. âœ… "Send Invitations" æŒ‰é’®å˜ä¸ºå¯ç”¨

**é…ç½®æœ‰æ•ˆæœŸ**
1. ä¿®æ”¹ "Validity Days" è¾“å…¥æ¡†ï¼ˆä¾‹å¦‚æ”¹ä¸º 60ï¼‰
2. âœ… æ•°å­—åº”è¯¥å¯ä»¥ä¿®æ”¹

**æ‰§è¡Œæ‰¹é‡å‘é€**
1. é€‰æ‹© 1-2 ä¸ªç”¨æˆ·
2. ç‚¹å‡» "Send Invitations"
3. ç­‰å¾…å‘é€å®Œæˆ
4. âœ… åº”è¯¥æ˜¾ç¤ºæˆåŠŸ Toast
5. âœ… è¡¨æ ¼è‡ªåŠ¨åˆ·æ–°
6. âœ… å·²å‘é€ç”¨æˆ·çš„ Status å˜ä¸º "Invited"
7. âœ… Credentials åˆ—æ˜¾ç¤ºç”Ÿæˆçš„ç”¨æˆ·åå’Œå¯†ç 

---

### Step 4: å‡­è¯æ“ä½œæµ‹è¯•

**æµ‹è¯•å¯†ç æ˜¾ç¤º/éšè—**
1. æ‰¾åˆ°ä¸€ä¸ªå·²å‘é€é‚€è¯·çš„ç”¨æˆ·
2. å¯†ç é»˜è®¤æ˜¾ç¤ºä¸º `â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢`
3. ç‚¹å‡»çœ¼ç›å›¾æ ‡ â†’ âœ… æ˜¾ç¤ºæ˜æ–‡å¯†ç 
4. å†æ¬¡ç‚¹å‡» â†’ âœ… éšè—å¯†ç 

**æµ‹è¯•å¤åˆ¶åŠŸèƒ½**
1. ç‚¹å‡»ç”¨æˆ·åæ—è¾¹çš„å¤åˆ¶å›¾æ ‡ â†’ âœ… Toast æç¤º "Username copied"
2. ç²˜è´´åˆ°è®°äº‹æœ¬ â†’ âœ… å†…å®¹æ­£ç¡®
3. ç‚¹å‡»å¯†ç æ—è¾¹çš„å¤åˆ¶å›¾æ ‡ â†’ âœ… Toast æç¤º "Password copied"
4. ç²˜è´´åˆ°è®°äº‹æœ¬ â†’ âœ… å†…å®¹æ­£ç¡®ï¼ˆæ˜æ–‡å¯†ç ï¼‰

---

### Step 5: å•ç‹¬å‘é€æµ‹è¯•

1. æ‰¾åˆ°ä¸€ä¸ª Pending ç”¨æˆ·
2. ç‚¹å‡»å³ä¾§ "Send" æŒ‰é’®
3. âœ… åº”è¯¥ç«‹å³å‘é€è¯¥ç”¨æˆ·çš„é‚€è¯·
4. âœ… æˆåŠŸåçŠ¶æ€æ›´æ–°ä¸º Invited

---

### Step 6: è¾¹ç•Œæƒ…å†µæµ‹è¯•

**ç©ºçŠ¶æ€**
1. åˆ‡æ¢åˆ° "Invited" Tabï¼ˆå¦‚æœæ²¡æœ‰å·²é‚€è¯·ç”¨æˆ·ï¼‰
2. âœ… æ˜¾ç¤ºç©ºçŠ¶æ€æç¤ºï¼š"No invitations sent yet"

**éƒ¨åˆ†å¤±è´¥åœºæ™¯**ï¼ˆéœ€è¦æ¨¡æ‹Ÿé‚®ä»¶æœåŠ¡å¤±è´¥ï¼‰
1. é€‰æ‹©å¤šä¸ªç”¨æˆ·å‘é€
2. å¦‚æœéƒ¨åˆ†é‚®ä»¶å‘é€å¤±è´¥
3. âœ… Toast æ˜¾ç¤ºè­¦å‘Šï¼š"Sent X invitations, Y failed"
4. âœ… æ˜¾ç¤ºå¤±è´¥è¯¦æƒ…
5. âœ… æˆåŠŸçš„ç”¨æˆ·çŠ¶æ€æ›´æ–°ï¼Œå¤±è´¥çš„ä¿æŒ Pending

**Loading çŠ¶æ€**
1. åˆ·æ–°é¡µé¢
2. âœ… åº”è¯¥çœ‹åˆ° TableSkeleton åŠ è½½åŠ¨ç”»

---

## ğŸ” åç«¯ API æµ‹è¯•

### å‡†å¤‡å·¥ä½œï¼šè·å–è¶…çº§ç®¡ç†å‘˜ Token

```bash
# ç™»å½•è·å– Token
curl -X POST "http://localhost:8000/api/v1/auth/jwt/login" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=YOUR_EMAIL&password=YOUR_PASSWORD"

# å¤åˆ¶è¿”å›çš„ access_token
```

### æµ‹è¯• API ç«¯ç‚¹

**1. è·å– Waitlist åˆ—è¡¨**

```bash
# æ‰€æœ‰ç”¨æˆ·
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:8000/api/v1/admin/waitlist-invites?status=all"

# ä»… Pending
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:8000/api/v1/admin/waitlist-invites?status=pending"

# ä»… Invited
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:8000/api/v1/admin/waitlist-invites?status=invited"
```

**2. æ‰¹é‡å‘é€é‚€è¯·**

```bash
curl -X POST "http://localhost:8000/api/v1/admin/waitlist-invites/batch-send" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "emails": ["test1@example.com", "test2@example.com"],
    "password_validity_days": 30
  }'
```

**3. éªŒè¯æƒé™ï¼ˆåº”è¯¥å¤±è´¥ï¼‰**

```bash
# ä¸å¸¦ Token
curl "http://localhost:8000/api/v1/admin/waitlist-invites?status=all"
# âŒ åº”è¯¥è¿”å› 401 Unauthorized

# ä½¿ç”¨æ™®é€šç”¨æˆ· Token
curl -H "Authorization: Bearer NORMAL_USER_TOKEN" \
  "http://localhost:8000/api/v1/admin/waitlist-invites?status=all"
# âŒ åº”è¯¥è¿”å› 403 Forbidden
```

---

## ğŸ“Š æ•°æ®åº“éªŒè¯

```sql
-- æŸ¥çœ‹ waitlist_emails è¡¨ç»“æ„
\d waitlist_emails

-- æŸ¥çœ‹æ‰€æœ‰è®°å½•
SELECT email, invited, username, password, expires_at, created_at 
FROM waitlist_emails 
ORDER BY created_at DESC;

-- æŸ¥çœ‹ Pending ç”¨æˆ·
SELECT email, source, created_at 
FROM waitlist_emails 
WHERE invited = false;

-- æŸ¥çœ‹å·²å‘é€ç”¨æˆ·çš„å‡­è¯
SELECT email, username, password, expires_at, sent_content 
FROM waitlist_emails 
WHERE invited = true;
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§
- [ ] è¶…çº§ç®¡ç†å‘˜å¯ä»¥è®¿é—® `/admin/waitlist`
- [ ] æ™®é€šç”¨æˆ·æ— æ³•è®¿é—®ï¼ˆè‡ªåŠ¨é‡å®šå‘ï¼‰
- [ ] Tab è¿‡æ»¤åŠŸèƒ½æ­£å¸¸
- [ ] æ‰¹é‡é€‰æ‹©åŠŸèƒ½æ­£å¸¸
- [ ] æ‰¹é‡å‘é€åŠŸèƒ½æ­£å¸¸
- [ ] å•ç‹¬å‘é€åŠŸèƒ½æ­£å¸¸
- [ ] å‡­è¯æ˜¾ç¤ºæ­£ç¡®ï¼ˆç”¨æˆ·åã€å¯†ç ã€è¿‡æœŸæ—¶é—´ï¼‰
- [ ] å¯†ç æ˜¾ç¤º/éšè—åˆ‡æ¢æ­£å¸¸
- [ ] å¤åˆ¶åŠŸèƒ½æ­£å¸¸
- [ ] Toast é€šçŸ¥æ­£å¸¸

### UI/UX
- [ ] è®¾è®¡è§„èŒƒä¸€è‡´ï¼ˆé¢œè‰²ã€å­—ä½“ã€é—´è·ï¼‰
- [ ] Loading çŠ¶æ€æ˜¾ç¤º
- [ ] ç©ºçŠ¶æ€æ˜¾ç¤º
- [ ] å“åº”å¼å¸ƒå±€æ­£å¸¸
- [ ] è¡¨æ ¼å¯æ»šåŠ¨ï¼ˆå†…å®¹è¿‡å¤šæ—¶ï¼‰

### å®‰å…¨æ€§
- [ ] åç«¯ API æƒé™éªŒè¯æ­£ç¡®
- [ ] å‰ç«¯è·¯ç”±æƒé™ä¿æŠ¤æ­£ç¡®
- [ ] å¯†ç é»˜è®¤éšè—
- [ ] JWT Token éªŒè¯æ­£å¸¸

---

## ğŸ› å·²çŸ¥é—®é¢˜/é™åˆ¶

1. **é‚®ä»¶å‘é€ä¾èµ–**ï¼šéœ€è¦é…ç½® `RESEND_API_KEY` ç¯å¢ƒå˜é‡ï¼Œå¦åˆ™é‚®ä»¶åªä¼šè®°å½•åˆ°æ—¥å¿—
2. **æ‰¹é‡å‘é€é™åˆ¶**ï¼šå•æ¬¡æœ€å¤šå‘é€ 100 ä¸ªé‚®ä»¶ï¼ˆå¯æ ¹æ®éœ€è¦è°ƒæ•´ï¼‰
3. **å¯†ç æ˜æ–‡å­˜å‚¨**ï¼š`waitlist_emails` è¡¨ä¸­çš„å¯†ç æ˜¯æ˜æ–‡ï¼Œä»…ç”¨äºé‚®ä»¶å‘é€ã€‚å®é™…ç”¨æˆ·å¯†ç ç»è¿‡å“ˆå¸Œå­˜å‚¨åœ¨ `users` è¡¨

---

## ğŸ“ æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šå·¦ä¾§è¾¹æ çœ‹ä¸åˆ° Admin åŒºåŸŸ

**å¯èƒ½åŸå› **ï¼šç”¨æˆ·ä¸æ˜¯è¶…çº§ç®¡ç†å‘˜

**è§£å†³æ–¹æ³•**ï¼š
```sql
-- æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ˜¯è¶…çº§ç®¡ç†å‘˜
SELECT id, email, is_superuser FROM users WHERE email = 'YOUR_EMAIL';

-- å¦‚æœä¸æ˜¯ï¼Œè®¾ç½®ä¸ºè¶…çº§ç®¡ç†å‘˜
UPDATE users SET is_superuser = true WHERE email = 'YOUR_EMAIL';
```

### é—®é¢˜ 2ï¼šAPI è¿”å› 401/403 é”™è¯¯

**å¯èƒ½åŸå› **ï¼šToken è¿‡æœŸæˆ–æƒé™ä¸è¶³

**è§£å†³æ–¹æ³•**ï¼š
1. é‡æ–°ç™»å½•è·å–æ–° Token
2. ç¡®è®¤ç”¨æˆ·æ˜¯è¶…çº§ç®¡ç†å‘˜
3. æ£€æŸ¥ Token æ˜¯å¦æ­£ç¡®æ”¾åœ¨ Header ä¸­

### é—®é¢˜ 3ï¼šé‚®ä»¶å‘é€å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- æœªé…ç½® `RESEND_API_KEY`
- é‚®ç®±åœ°å€æ— æ•ˆ
- Resend API é™æµ

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `RESEND_API_KEY`
2. æ£€æŸ¥åç«¯æ—¥å¿—ï¼ˆ`structlog` è¾“å‡ºï¼‰
3. éªŒè¯é‚®ç®±åœ°å€æ ¼å¼
4. æŸ¥çœ‹ Resend æ§åˆ¶å°

### é—®é¢˜ 4ï¼šæ•°æ®åº“è¿ç§»å¤±è´¥

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æŸ¥çœ‹å½“å‰è¿ç§»çŠ¶æ€
cd backend
uv run alembic current

# å¦‚æœéœ€è¦é‡ç½®ï¼Œé™çº§å†å‡çº§
uv run alembic downgrade ede0773860b9
uv run alembic upgrade head
```

---

## ğŸ‰ æµ‹è¯•å®Œæˆ

å®Œæˆä»¥ä¸Šæµ‹è¯•åï¼ŒWaitlist é‚€è¯·ç®¡ç†åŠŸèƒ½å³å¯æŠ•å…¥ä½¿ç”¨ï¼

